<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">
<html>
<head><title>PDF document creator based on TCPDF/FPDF</title>
<meta http-equiv="content-type" content="text/html; charset=iso-8859-1">
<link rel="stylesheet" type="text/css" href="helpstyles.css">
</head>
<body>

<!-- DOC BEGIN -->

<h3>PDF document creator based on TCPDF/FPDF</h3>

There are many PDF creators written in PHP : Zend Framework has one (Zend_Pdf), FPDF, TCPDF...
<br>But no one or them is able to create final document based on "source" PDF template, by populating it with user data.
(or maub i did not find it).

<br /><br />
This class, CPrintfromPdf, written for automaying that process: basically it can load "source" PDF file as template,
fill it with data, prepared in your program, and send final document to the clietn (or saves it to the disc).

<br />This class is a wrapper for the famous class TCPDF, (it was chosen as most powerful and still "growing"),
with "a little help" of FPDF / FPDFI classes, used for loading source PDF template file.

<br><br>Main class features:
<ul>
  <li>using of "source" PDF files as template, or "background" for your data</li>
  <li>configurable output for user data: all parameters (position, font size, color, rotation angle, maximal width etc.)
    stored in comprehensive XML format
     </li>
  <li>draws user image files, into desired position, with needed width / height (it's useful for printing "human" signatures, stamps etc.)</li>
  <li>printing barcodes and QR-codes (all types that supported in TCPDF)</li>
  <li>it's possible to create many similar "final documents" in one output PDF file: for example, You may create agreements for many people, or a bunch of letter envelopes
   </li>
  <li>Duplicating data on the sheet if needed (printing business cards etc.)</li>
  <li>class has few experimental "bonus" functions (generating lined sheet, blank "music sheets", and Sudoku puzzle)</li>
  <li>(since 1.1) supporting of <a href="#plugins">plugins</a> for printing new graphical objects inside PDF page</li>
  <li>(since 1.4) supporting specific fields to be printed on every document page (logos, bar-codes, "DEMO-PAGE" notificatuins etc.)</li>

</ul>


<h4>Installing on the web server</h4>
The main module is <b>printform-pdf.php</b>, so you need to copy it into one of "include_path" folders.
Besides, You have to download and install following open source modules:
 <ol>
   <li>TCPDF - PHP classes for creating PDF documents. Here is a link: <a href="http://tcpdf.org" target="_blank">tcpdf.org</a></li>
   <li>Modules FPDF-FPDFI also needed, as they can parse existing PDF file contents and make it a part of TCPDF object.
   Can be found on site <a href="http://www.setasign.de/products/pdf-php-solutions/fpdi/downloads/" target="_blank">http://www.setasign.de/</a></li>
   <li>If you're going to generate Sudoku puzzles, you have to download and install a module <a href="http://www.phpclasses.org/package/2674-PHP-Generate-and-solve-sudoku-puzzles.html">class.Sudoku.php</a>

 </ol>
 If You use specific national language, You have to generate some "font" modules from your TTF font files, and put them into
 tcpdf/fonts folder.
 <br>TCPDF distributive has utility that can do it, so You can find it and using instructions inside TCPDF contents
 (fonts/utils folder).
 <br>Don't forget, you'll have to create font modules for ALL fonts You're goung to use.
 Base default font for CPrintformPDF is <b>arial</b>, so it is a good idea to firstly create font modules for Your language from this truetype font.


<h4>Using the class</h4>

Below is a simple example that shows the main functionality: it creates PDF file from source template file 'pdf-template.pdf'.
It will receive your data and place it "over" the template, to generate "final" PDF :
<pre>if(!class_exists('TCPDF',false)) {
    require_once('tcpdf/config/lang/rus.php'); // Here we need to include module for our language, russian in my case
    require_once 'tcpdf/tcpdf.php';
    require_once 'fpdf/fpdi2tcpdf_bridge.php';
    require_once 'fpdf/fpdi.php';
}
require_once('printform-pdf.php');

$xmlcfg = "pdf-config.xml"; // your config file

$pdf = new CPrintFormPdf(array(
    'configfile' =&gt; $xmlcfg
   ,'outname' =&gt; "output-file.pdf"
   ,'author'  =&gt; 'Some clever guy'
   ,'creator' =&gt; 'Test program'
   ,'title'   =&gt; 'Generated test PDF'
   ,'subject' =&gt; 'Testing PDF creation filled by user data'
   ,'compression' =&gt; true
));

$userdata = array(
    'cityname' =&gt; 'Moscow'
   ,'personname' =&gt; 'Dow'
   ,'person_firstname' =&gt; 'John'
   ,'person_birthdate' =&gt; '04/15/1970'
   ,'person_document' =&gt; 'Passport 0034 010203'
   ,'demostring' =&gt; 'DEMONSTATION!'
);
$pdf-&gt;AddData($userdata);
$pdf-&gt;Render(); // generated PDF wiil be sent to the client, so the browser will ask to open or save it.
</pre>

<h4>Configuration XML file format</h4>
Below is example of configuration file for our tyny program.
(let's call it <b>pdf-config.xml</b>).

<pre>&lt;?xml version="1.0" encoding="UTF-8"?&gt;
&lt;printdef&gt;
  &lt;version&gt;1.0&lt;/version&gt;
  &lt;title&gt;Testing PDF generation&lt;/title&gt;
  &lt;description&gt;This is a test PDF document created by CPrintfromPDF class&lt;/description&gt;
  &lt;stringcharset&gt;UTF-8&lt;/stringcharset&gt;

  &lt;baseparameters&gt;
    &lt;margins left="0" top="0" right="0" bottom="0" /&gt;
    &lt;font name="arial" size="6" /&gt;
    &lt;page orientation="P" size="A4" units="mm" /&gt;
    &lt;templatefile src="pdf-template.pdf"  /&gt;
  &lt;/baseparameters&gt;

  &lt;pages&gt;
   &lt;page&gt;
      &lt;template page="1" /&gt;
      &lt;field name="cityname" posx="143" posy="26" /&gt;
      &lt;field name="personname" posx="42" posy="26" /&gt;
      &lt;field name="person_firstname" posx="88" posy="26" width="20" /&gt;
      &lt;field name="person_birthdate" posx="42" posy="32" width="70" /&gt;
      &lt;field name="person_document" posx="143" posy="32" width="55" /&gt;
      &lt;field name="demostring"     posx="50"  posy="110" rotate="45" size="40" color="#EE4040"/&gt;
   &lt;/page&gt;
  &lt;/pages&gt;
&lt;/printdef&gt;
</pre>

As You see, XML code has a section for "base parameters",
(title,description, stringcharset, templatefile), and a section that exactly describes how to output user data.

<br><b>baseparameters</b> contains base parameters that affect the whole document,
<br>and section <b>pages</b> contains blocks &lt;page&gt; ... &lt;/page&gt;, each of them holds coordinates,
font sizes/names, color, rotation angle for passed user string data or images inside one page of the document.

<br><br>
<b>templatefile</b> tag in "baseparameters" section contains filename for the "main" template PDF file, that will be used as "background"
for your document (<b>src</b> attribute). We'll see later what it is.

<p>
Page block can contain one more type of definition : <b>datagrid</b>. What's this ?
<br>Imagine, You want to print a grid (table) with info about up to 30 employees on the PDF page, each one of them contains his/her name, birth date, duty and salary.
<br>To implement this by ordinary way, you should describe 30 field blocks:
<pre>
  ...
  &lt;page&gt;
      &lt;field name="emp_name1" posx="10" posy="26" /&gt;
      &lt;field name="emp_birthdate1" posx="50" posy="26" /&gt;
      &lt;field name="emp_duty1" posx="80" posy="26" /&gt;
      &lt;field name="emp_salary1" posx="120" posy="26" /&gt;

      &lt;field name="emp_name2" posx="10" posy="32" /&gt;
      &lt;field name="emp_birthdate2" posx="50" posy="32" /&gt;
      &lt;field name="emp_duty2" posx="80" posy="32" /&gt;
      &lt;field name="emp_salary2" posx="120" posy="32" /&gt;
      /**... and so on **/
  &lt;/page&gt;
  ...
</pre>

<br>"datagrid" definition makes it much easier:
<pre>
  ...
  &lt;page&gt;
      &lt;field name="emp_name" posx="10" /&gt;
      &lt;field name="emp_birthdate" posx="50" /&gt;
      &lt;field name="emp_duty" posx="80" /&gt;
      &lt;field name="emp_salary" posx="120" /&gt;
      &lt;datagrid name="empl_grid" fields="emp_name,emp_birthdate,emp_duty,emp_salary" posy="26" step_y="6" rows="30" /&gt;
  &lt;/page&gt;
  ...
</pre>

"<b>datagrid</b>" definition contains : <ul>
    <li>"<b>name</b>" - unique name for that grid,</li>
    <li>"<b>fields</b>" - comma delimited field list, </li>
    <li>"<b>posx</b>" - grid horizontal position: this value will be added to all X-coordinates of a grid fields (think about it as a horizontal offset).
    <li>"<b>posy</b>" - vertical position of the "first" data row printed in the grid,</li>
    <li>"<b>step_y</b>" - vertical step (distance between grid rows),</li>
    <li>"<b>rows</b>" - maximal amount of rows in this grid (it's your responsibility to ensure that all rows fit on the page !)</li>
</ul>

Remember, in XML file datagrid definition must be placed after definitions of all fields listed in it's "fields" attribute !

<br><br>
When generating PDF document, to populate this grid with your employee data, you can use following approaches:
<ol>
  <li>While preparing data array for AddData($data) method, You fill every "numbered" field value in it:<br>
  <pre>$data[emp_name1'] = 'Joshua Gordon';
$data['emp_birth1'] = '1980-04-20';
...
$data['emp_name2'] = 'Alex Johnson';
$data['emp_birth2'] = '1975-10-09';
...
$pdf-&gt;AddData($data);
</pre>

  </li>
  <li>You can prepare all other data except your grid, call AddData() to pass them, and after that you call special method AddDataGridRow():<br><br>
<pre>// we assume that each $employees element is an associative array with needed values
foreach($employees as $oneempl) {
  $pdf-&gt;AddDataGridRow('empl_grid', $oneempl);
}
$pdf-&gt;AddData($data);
</pre>
  AddDataGridRow() can be called as many times as needed to pass all employees info (up to 30 in our example).
  </li>

  <li>All "grid" data can be passed as a part of full user data while calling AddData() method.<br>
  You have to use specific 'field name' for that case, that contains prefix 'grid:' and grid ID:
  <br>
  <pre>$data['grid:empl_grid'] = array(
     array('emp_name'=&gt;'Joshua Gordon', 'emp_birth'=&gt;'1980-04-20')
    ,array('emp_name'=&gt;'Alex Johnson', 'emp_birth'=&gt;'1975-10-09')
);
$pdf-&gt;AddData($data);
$pdf-&gt;Render();
  </pre>
  </li>
</ol>

<h4>Bonus features</h4>

Besides "main function" of formatted printing, class CPRintformPdf contains some experimental functions that can be useful for some people:

<ul>
  <li>Creating "lined" sheet (horizontal lines or horizontal and vertical lines) - <a href="#AddPageLined">AddPageLined()</a> method,</li>
  <li>sheet music notation page - <a href="#AddPageMusicStaff">AddPageMusicStaff()</a> (music school students might like it :-) ,</li>
  <li>page with a famous puzzle Sudoku - <a href="#AddPageSudoku">AddPageSudoku() method</a>.</li>
</ul>

<h4>Class methods</h4>

Class constructor :

<br><br>CPrintformPDF($param=''),
<br>$param can be a filename of configuration XML file OR XML string containing all definition, OR associative array ('key'=&gt;value form) :
<table>
  <tr><th>Key</th><th>Description</th><th>default value</th>
  </tr>
  <tr class="odd">
    <td>template</td>
    <td>The name of source PDF template file</td>
    <td>--</td>
  </tr>
  <tr class="odd">
    <td>outname</td><td>output file name</td><td>--</td>
  </tr>

  <tr>
    <td>compression</td>
    <td>compression mode for created PDF (your PHP should have ZIP functions support !)</td>
    <td>false</td>
  </tr>

  <tr class="odd">
    <td>tofile</td>
    <td>if not empty value, instead of echoing to user stream, generated file will be saved to the disc with the name passed in "<b>outname</b>" parameter</td>
    <td>false</td>
  </tr>

  <tr>
    <td>configfile</td>
    <td>passes XML configuration file name</td>
    <td>&nbsp;</td>
  </tr>

  <tr class="odd">
    <td>subject</td>
    <td>Contents for <b>Subject</b> field in PDF document</td>
    <td>empty string</td>
  </tr>

  <tr>
    <td>author</td>
    <td>Contents for <b>Author</b> field in PDF document</td>
    <td>CPrintFormPdf, TCPDF wrapper class</td>
  </tr>

  <tr class="odd">
    <td>creator</td>
    <td>Contents for <b>Creator</b> field in PDF document</td>
    <td>printform-pdf module ...</td>
  </tr>

  <tr>
    <td>stringcharset</td>
    <td>Character set name used in Your data. It's nessesary to correctly convert the, into UTF-8,
    and it must be one of charsets supported by PHP's <b>iconv()</b> function.
    No need to set this parameter if You will pass UTF-8 encoded data to CPrintFormPDF</td>
    <td>''</td>
  </tr>

</table>

Here is full description for configuration parameters in XML file.
<br><br>
<table width="100%">
  <tr>
    <th>Parameter</th><th colspan="2">Description</th><th>Value by default</th>
  </tr>
  <tr>
    <td><b>stringcharset</b></td><td colspan="2">User data character set (described above)</td><td>""</td>
  </tr>
  <tr class="odd">
    <td><b>title</b></td><td colspan="2">String for the respective PDF file properties field</td><td>""</td>
  </tr>
  <tr>
    <td><b>description</b></td><td colspan="2">String for the respective PDF file properties field</td><td>""</td>
  </tr>
  <tr>
    <td rowspan="4"><b>page</b></td><td colspan="3">Common page parameters:</td>
  </tr>
  <tr>
    <td><b>orientation</b></td><td>Sheet orientation : 'P' (portrait) or 'L' - landscape</td><td>'P'</td>
  </tr>
  <tr>
    <td><b>size</b></td><td>Sheet size('A4', 'A5' etc.)</td><td>'A4'</td>
  </tr>
  <tr>
    <td><b>units</b></td><td>Base units (all positions, sizes will use it)</td><td>'mm'</td>
  </tr>

  <tr><td class="topic" colspan="4">Section "<b>baseparameters</b>"</td></tr>
  <tr>
    <td rowspan="3"><b>font</b></td><td colspan="3">Sets "main" font parameters, used as default for all text output

    <br>Example: &lt;font name="verdana" size="3.5" /&gt; </td>
  </tr>
  <tr>
    <td>attribute <b>name</b></td><td>base font name</td><td>arial</td>
  </tr>
  <tr>
    <td>attribute <b>size</b></td><td>base font size, in units (mm)
    </td><td>4</td>
  </tr>
  <tr>
    <td rowspan="2"><b>margins</b></td><td colspan="3">Page margins
    <br>Example: &lt;margins left="10" top="5" right="10" bottom="2" /&gt; </td>
  </tr>
  <tr>
    <td>Attributes <b>left,right, top, bottom</b></td><td>indents from left, right etc.</td><td>0</td>
  </tr>
  <tr>
    <td rowspan="2"><b>templatefile</b></td>
    <td>Attribute "<b>src</b>"</td>
    <td>contians main PDF template filename for all pages</td>
    <td>''</td>
  </tr>
<!--
  <tr>
    <td>attribute "<b>altsrc</b>"</td>
    <td>contians main <b>alternate</b> PDF template filename for all pages</td>
    <td>''</td>
  </tr>
-->
  <tr><td class="topic" colspan="4">Section "<b>pages</b>" - contains a set of &lt;page&gt; ... &lt;/page&gt; blocks - each of them
  describes one printed page (positions and other parameters for printing user data)</td></tr>

  <tr>
    <td rowspan="3"><b>template</b></td><td colspan="3">Tag &lt;template&gt; sets PDF file name, used as "source" for this page of document.
    <br>Example: &lt;template src="template.pdf" page="1" /&gt; </td>
  </tr>
  <tr>
    <td>attribute <b>src</b></td><td>full PDF filename with a path (if nessesary). If not set, "main" template PDF will be used for this page.</td><td></td>
  </tr>
  <tr>
    <td>attribute <b>page</b></td><td>sais what page of source file will be used as "template" for the current document page (numeration starts with 1). If you want draw PDF template for this page,
    you must pass non-zero page value.</td><td>0</td>
  </tr>

  <tr>
    <td rowspan="15"><b>field</b></td><td colspan="3">Sets parameters for printing one user data field
    <br>Example: &lt;field name="cityname" posx="143" posy="26" /&gt; </td>
  </tr>
  <tr>
    <td>attribute <b>name</b></td><td>field name. User data array should have an element with the key identical to this name</td><td>--</td>
  </tr>
  <tr>
    <td>attribute <b>type</b></td><td>Field type. By default all fields treated as simple text. Supported types:<br>
     <b>type="image"</b> sets image file. Attribyte "src" should exist and contain existing image file name,<br>
     <b>type="checkbox"</b> - if user passed data for this field is not empty, turned on "checkbox" char will be printed

     <br><b>type="poly"</b> draws open polygon, you should pass arrays of coordinates in attributes <b>posx</b>, <b>posy</b>.
     Amount of "x" znd "y" values should be equal, (the rest of values in "bigger" list will be ignored).

     <br>
     <b>type="barcode"</b>, <b>type="qrcode"</b> - these types used to print bar code and QR-code, respectively.
     (See details <a href="#barcodes">here</a></td><td>--</td>
  </tr>
  <tr>
    <td>Attributes <b>posx, posy</b></td><td>Set exact start position for printing the field.<br>
    Attribute <b>posx</b> can be a comma delimited value list - see details <a href="#posx_array">later</a>.
    </td><td>0,0</td>
  </tr>
  <tr>
    <td>Attributes <b>width, height</b></td><td>Used to limit maximal width anf height for the text field. Zero values mean "no limit".
    TCPDF perform auto word wrapping, so long texts can be printed in more than one line.
    For the <b>image</b> and barcode/QR-code fields <b>width</b> and <b>height</b> set real picture size (auto-scaling will be performed). <br>
    <b>Attention</b>: If both parameters passed for image field, the printed image can be stretched.
    </td><td>0,0</td>
  </tr>
  <tr>
    <td>attribute <b>charstep</b></td><td>Sets a horizontal step - distance between printed shars of the string.
    If non-zero charstep passed, user data will be printed "by char" with this step.
    Useful if you print data into bordered "squares" on the blanc form that was designed for manual filling.</td><td>0</td>
  </tr>
  <tr>
    <td>attribute <b>maxlength</b></td><td>Sets limit for the printed string. Actual user data will be cut if it's longer then maxlength</td><td></td>
  </tr>

  <tr>
    <td>attribute <b>font</b></td><td>Sets font name. By default "base" font is used for all fields.</td><td></td>
  </tr>
  <tr>
    <td>attribute <b>size</b></td><td>Sets font size.</td><td>0</td>
  </tr>
  <tr>
    <td>attribute <b>color</b></td><td>Color for printed characters. Any values supported by TCPDF class
    ("rgb(n1,n2,n3)", "gray"/"black", 3- or 6-digit Hex-code) can be used. Default color is black.
    <br>It is possible to pass user function name (after the "@" char), so the color will be "calculated" right before printing
    : "@MyColorFunction"
    </td><td></td>
  </tr>
  <tr>
    <td>attribute <b>bgcolor</b></td><td>Set background color.  Any values supported by TCPDF class can be used.
    <br>It is possible to pass user function name (after the "@" char), so the color will be "calculated" right before printing : "@MyColorFunction".
     <br>When bgcolor set, filled rectangle is rendered first, and then text value is printed above it.
    If <b>bgcolor</b> used, Non-empty attributes  <b>width</b> and <b>height</b> are amust, otherwise rectangle won't be drawn.
    <br>Use this attribute to "hide" some unwanted areas (usually came from pdf template) on the page and print something else instead.
    </td><td></td>
  </tr>

  <tr>
    <td>attribute <b>align</b></td><td>Horizontal aligning. Possible values (L,R,C,J) must conform TCPDF requirements</td><td></td>
  </tr>
  <tr>
    <td>attribute <b>options</b></td><td>Additional options string, it is used in barcode and QR-code fields.
    <br>It is possible to pass user function name (after the "@" char), so the options string will be "calculated" right before printing
    : "@MyOptionsFunction"
    </td><td>--</td>
  </tr>

  <tr>
    <td>attribute <b>src</b></td><td>used in "image" field to pass image file name.
    This must be one of graphic files supported by TCPDF</td><td></td>
  </tr>
  <tr>
    <td>attribute <b>rotate</b></td><td>You can rotate any element (text, image, barcode, QR-code) by desired angle (value in grads, counterclockwise)</td><td>""</td>
  </tr>

</table>

<br><br>One user data value can be printed more than once on the page: to do this, you just describe additional  &lt;field ... &gt; blocks in  XML definition
with the same <b>name</b> attribute.

<a name="posx_array"></a>
<h4>Value array in posx</h4>
As mentioned, you can print strings using "charstep", so single chars will be printed with desired step.
But there are cases when You need "different" positions for every char, or even omit some of them.
For instanse, we're printing date field that is passed in "MM/DD/YYYY" format, into six "cells" (MM | DD | YY),
si we need to cut "slashes" and two first year digits from source string.
So we can form "posx" attribute like this:
<br>
<pre>&lt;field name="date_entered" ... posx="50,54,0,70,74,0,0,0,90,94" /&gt;</pre>
<br><br>
Every zero value means "skip this char", so only month, day and two-digit year will be printed,
and these chars will be placed on exact positions we passed.
<br>As our posx array has only 10 values, all the rest source characters (if any) will be ignored.

<br><br>
<b>LoadConfig([$cfgname])</b> - loads configuration from XML file with passed name. You can use it if you didn't pass that name in class constructor.
You can pass the whole XML string instead of file name - it will be parsed the same way as xml file contents.

<!--
<br><br>
<b>SetAltTemplate($alt=true)</b> - turns "ON" using of alternate template PDF file.

<br><br>
<a name="alterpdf"></a>What's this, and what for ?

<br><br>
Depending on real situation, You can switch pdf template "on the fly", without having to make another XML configuration.
Example: "Basic" template can have a full designed document with all graphics, stamps, company logo etc. so a final user could print it on clean paper sheet.
But what if user has a "typografic" document blanc with all needed elements ?

<br>Here alternate template will save us :
<br>you prepare "clean" PDF template, store it's name in "altsrc" attribute, and call SetAltTemplate() before final Render() method,
and voila, the final PDF will be pretty good for drawing on typografic printed form.
-->

<br><br>
<b>addPageDef($opts=array())</b> - programmatically adds definition for one PDF page. You can prepare associative array that contains the following items
and pass it ti this method:
<br>
<b>$opts['template']</b> - associative array, describes source PDF file parameters to use as "template" for the page (See template attributes for all supported values)
<b>$opts['fields']</b> - associative array, describes all fields on this page (See "field" attributes for all supported values)<br>
<b>$opts['repeat']</b> - array, describes <a href="#f_repeat">"repetition"</a> on the page. Equivalent to "repeat" tag in XML configuration file.


<br><br>
<b>AddFieldDefinition($ipage, $parm)</b> used to programmatically add one field definition for the page.
<br>$ipage - page number, $parm - associative array with field definition, all possible keys described earlier for the field tag:
posx, posy, width, height, type, etc.

<br><br>

<b>setTitle($strg)</b> sets Title attribute for the PDF.

<br><br>
<b>setSubject($strg)</b> sets Subject attribute for the PDF.

<br><br>
<b>setAuthor($strg)</b>  sets Author attribute for the PDF.

<br><br>
<b>setCreator($strg)</b>  sets Creator attribute for the PDF.

<br><br><a name="disableImages"></a>
<b>disableImages($par=true)</b> - turns off drawing of all images on the docyment. May be useful if you want to hide stamps, logos or faximile signatures in the case of test printing or whatelse.

<br><br>
<b>AddData($entitydata)</b> passes whole user data block for one printed document.
It's possible to call this more than once: every AddData() creates the full document in output PDF.
<br>
So you can create PDF file that contains "agreements" for many people, or many letter envelopes and so on.

<br>Data array has a familiar structure - every key is one of field names described in printing configuration.

<br><br>
<b>DrawMeasuringGrid($step = 10, $color = false)</b> - function for fine-tuning : it draws a measuring grid, so you can
find right <b>posx</b> and <b>posy</b> coordinates for all your data.

<br>$step is a horizontal and vertical step, $color is grid color. By default step is 10mm.
If you pass "1" value or TRUE, this interpreted as "Yes" (not 1mm), mean 'yes, print the grid with default step 10mm'.
Default grid color - gray, (RGB: 80,80,80).

<br><br>
<b>addPluginData($name, $data)</b> : passes data that must be visualized in "plugin" field, by calling respective plugin methods.
See details in <a href="#plugins">plugins section</a>.

<br><br><a name="setResourcePaths"></a>
<b>setResourcePaths($pdfPath=null, $imgPath=null)</b> : by default printformPdf treats all PDF templates and image file names in "current folder" context.
But all these "resources" may be placed somewhere else, in special sub-folder "resources/" for example. If you don't want to add this (sometimes quite long) paths to ALL
"src" attributes in your XML configuration file, just use this method to add "real folders" where these files located.
<br>First parameter <b>$pdfPath</b> sets path for PDF template files, and <b>$imgPath</b> set the path for images.



<br><br><b>Render($output=true)</b> : Finally creates output PDF document and sends it to the client (http stream) or saves to the disc
(depends on active mode).
 If you pass zero $output value, output/saving won't be done, and PDF "object" remains open for additional operations.
 For instanse, you may want to print some final strings that was not described in configuration, ar even add new page.
 All these operations can be done by direct calling methods from TCPDF class:
 to do this, you need a TCPDF object, right ?
 OK, call the method <b>getPdfObject()</b> to get it.
<br>When all operations done, don't forget to call <b>Output()</b> method.

<pre>// Here we will draw horizontal line to our PDF
$pdf = new CPrintFormPdf(...);
...
$pdf-&gt;AddData($mydata);
$pdf-&gt;Render(false);
$tcpdf = $pdf-&gt;getPdfObject();
$tcpdf-&gt;Line(10,100,190, 100);
$pdf-&gt;Output(); // finally closing PDF and sending it to the client/storing to disc
</pre>

<a name="barcodes"></a>
<h4>Printing Bar codes</h4>
Due to Bar-code support in TCPDF, PrintFormPDF can also print any of bar codes supported by TCPDF.

<pre>Bar code Deninition fragment:
      ...
      &lt;field name="barcode_crc" type="barcode:C128" posx="10"  posy="180" width="40" height="10" options="border,text" color="#EE4040"/&gt;
      ...
</pre>
Attribute type="..." sets "barcode" type and, after some "delimiter" char (":" in our case) we pass the desired barcode type.
As You can guess, this type must be one of types supported by TCPDF class. If type omitted, default "C39" is used.
<br>
For TCPDF version 5.9.109 following barcode types supported (list is not full, it's just for give You a hint) :<br>
C39, C39+, C39E, C39E+, C93, S25, S25+, I25, I25+, C128, C128A, C128B, C128C, EAN2, EAN5, EAN8, ...

<br><br>
See full supported types list in TCPDF documentation or PHP sources.

<br><br>
Attribute options has a special meaning for barcode field: it must be a comma-delimited string, containg combination of following "words":
<table><tr><th>Word</th><th>What it does</th></tr>
  <tr><td>border</td><td>Turns on drawing border around bar code</td></tr>
  <tr><td>text</td><td>Turns on printing textual presentation of user data to be coded (text is printed in the bottom of barcode)</td></tr>
</table>
Attributes color, rotate, width, height affect printed barcode by obvious way. Keep in mind that too small width can make "distorted" barcode,
"unreadable" by barcode scanners !

<br><br>
<a name="qrcodes"></a>
<h4>Printing QR-codes</h4>
When You use field type "qrcode", user data passed in that field will be encoded to QR-code.
It is a good idea to pass the same height and width for QR-code, isn't it ?
Attributes color, rotation affect printed QR-code. Again, be careful with too small width and height.

<a name="f_repeat"></a>
<h4>Duplication of all data on the page : "<strong>repeat</strong>" tag</h4>

What if you want to have multiple identical blocks of data printed on the page ? Good example for this is business card printing.
Of cource, you can create "complex" XML definition that will contain many replicas of the same field set, with changed x- and y- positions.
You'll agree that it's not convenient: when you need to add a single field, you will have to make many instances of its definition,
every position tuning will mean re-calculating and changing many X and Y coords.
<br><br>Tag "repeat" was added to avoid this inconvenience : all you need is set two offsets (x and Y) for every instance of data block relative to the "original"
definition.

<br><br>You may guess how it works:
<br>All printing elements, defined in the page (text fields, checkboxes, images, polygons, barcodes, QR-codes) are treated as one data block, so this block
will be printed again on the same page, with respective X and Y offsets.
You can set as many "repeat" tags for the page as needed.
<br>Below is example of printing business card with using "repeat: feature". This example includes service lines (polygons in corners) that should be used for cutting printed sheet to cards.


<br><br><b>Note</b>: If you want to exclude some data fileds from repeating (they must be printed ONCE), just add in its attributes this element:
<br><b>norepeat="1"</b>.

<pre>
&lt;?xml version="1.0" encoding="UTF-8"?&gt;
&lt;printdef&gt;
  &lt;version modified="2012-11-02"&gt;1.0&lt;/version&gt;
  &lt;title&gt;Visit card template&lt;/title&gt;
  &lt;baseparameters&gt;
    &lt;margins left="0" top="0" right="0" bottom="0" /&gt;
    &lt;font name="arial" size="8" /&gt;
    &lt;page orientation="P" size="A4" units="mm" /&gt;
  &lt;/baseparameters&gt;

  &lt;pages&gt;
   &lt;page&gt;
   &lt;template page="1" /&gt;
    &lt;field name="corner1" type="poly" posx="10,10,14" posy="14,10,10" color="#AAA" /&gt;
    &lt;field name="corner2" type="poly" posx="91,95,95" posy="10,10,14" color="#AAA" /&gt;
    &lt;field name="corner3" type="poly" posx="10,10,14" posy="61,65,65" color="#AAA" /&gt;
    &lt;field name="corner4" type="poly" posx="91,95,95" posy="65,65,61" color="#AAA" /&gt;

    &lt;field name="logo" type="image" posx="12" posy="12" width="26" height="26" src="logo.png" /&gt;
    &lt;field name="lastname" posx="45" posy="20" width="35" color="#008" size="14" /&gt;
    &lt;field name="firstname" posx="45" posy="28" width="35" size="12"/&gt;
    &lt;field name="middlename" posx="45" posy="35" width="35"  size="12" /&gt;
    &lt;field name="duty"       posx="45" posy="42" width="35" size="7"/&gt;
    &lt;field name="phones"     posx="15" posy="52" width="75" align="C" size="7"/&gt;
    &lt;!-- duplicate card on the page --&gt;
    &lt;repeat offset_x="88" offset_y="0" /&gt;
    &lt;repeat offset_x="0" offset_y="57" /&gt;
    &lt;repeat offset_x="88" offset_y="57" /&gt;
    &lt;repeat offset_x="0" offset_y="114" /&gt;
    &lt;repeat offset_x="88" offset_y="114" /&gt;
    &lt;repeat offset_x="0" offset_y="171" /&gt;
    &lt;repeat offset_x="88" offset_y="171" /&gt;
    &lt;repeat offset_x="0" offset_y="228" /&gt;
    &lt;repeat offset_x="88" offset_y="228" /&gt;

   &lt;/page&gt;
  &lt;/pages&gt;
&lt;/printdef&gt;
</pre>
Save this definition in the XML file (call it, sat, "pdf-card.xml"), and now you can easily create PDF with ready-to-print business card with your personal data:
<br>(We use sample logo file named "logo.png" - change it to your name or make sure you have a file with this name)
<pre>
$pdfOptions = array('outname' =&gt;'mycard.pdf', 'configfile' =&gt; 'pdf-card.xml');
$pdf = new CPrintFormPdf($pdfOptions);
$data = array(
     'lastname'=&gt;'Stivenson'
    ,'firstname'=&gt;'Alex'
    ,'middlename'=&gt;'Jr'
    ,'duty'=&gt;'Senior Sales Manager'
    ,'phones'=&gt;'+1(555)111-2200, 111-2233'
);
$pdf-&gt;AddData($data);
$pdf-&gt;Render();

</pre>

<a name="apfields"></a>
<h4>Fields printed on all pages</h4>

Sometimes we need to print one text, bar-code or image on the same place in every document page (with the same font, size, rotation etc.)
Of cource you could insert this &lt;field&gt; definition in all "page" sections. But it would be more convenient to do it once, isn't it ?
Here is "allpages" section top help us. &lt;field&gt;. It must be placed inside "root" element of XML configuration file, and should contain standard "field" definitions for
every "all pages" field.
<br>
Below is example (we want a bar-code at the bottom ao all pages):
<pre>
&lt;?xml version="1.0" encoding="UTF-8"?&gt;
&lt;printdef&gt;
  &lt;version&gt;1.0&lt;/version&gt;
  &lt;title&gt;Testing PDF generation&lt;/title&gt;
  &lt;allpages&gt;
    &lt;field name="bar_code01" type="barcode" posx="100" posy="280" width="50" height="5" options="text" value="012345678" /&gt;
  &lt;/allpages&gt;
  ...
&lt;/printdef&gt;
</pre>
the only difference in <b>field</b> tag is "value" attribute support - we can set desired text (value) for all pages right in XML file.
And, you can change this value programmatically by calling method setAllPagesFieldValue($filename, $value), or by passing value with the same field name in "user data", passed in
addData(). Remember: value from user data has a priority above "default" value from XML or passed in setAllPagesFieldValue().

<br><br>And there is a method <b>addAllPagesField</b>($fdef, $value=null), that adds one field definition for "all pages", it is equivalent to one <b>field</b> sction in <b>allpages</b> block of your
XML-config file.


<a name="plugins">
</a><h4>Plugin support</h4>

Since version 1.1 printform-pdf supports new feature - plugins. There is a new abstract class definition, <b>PfPdfPlugin</b>, that is a skeleton
for all plugins that can be connected to class CPrintformPdf.
<br>
In CPrintformPdf context plugin performs rendering inside rectangle area, specified by start coordinates and width and height.
First you write your own php class file, that extends PfPdfPlugin and implements following methods:
<br><br>
<b>__construct($tcpdfobj, $cfg = null, $x=0, $y=0, $w=0, $h=0)</b> - class constructor, that should receive a TCPDF object reference as a context to output,
 optional array of configuration parameters ($cfg), and x-position, y-position, width and height of "plot area" (parameters $x,$y,$w,$h respectively).

<br><br><b>Render($data)</b> - the main method that will generate output inside plot area. It should receive one parameter, data to be visualised.

<br><br>To use plugin, you should include it in your program module AFTER printform-pdf.php:

<pre>
require_once('printform-pdf.php');
require_once('my-plugin.php');
</pre>

Next, add a "plugin" definition in "page" area of your XML configuration file:

<pre>&lt;?xml version="1.0" encoding="UTF-8"?&gt;
&lt;printdef&gt;
  ...
  &lt;pages&gt;
   &lt;page&gt;
      &lt;template page="1" /&gt;
      &lt;field name="cityname" posx="143" posy="26" /&gt;
      &lt;field name="personname" posx="42" posy="26" /&gt;
      &lt;field name="person_firstname" posx="88" posy="26" width="20" /&gt;
      &lt;field name="person_birthdate" posx="42" posy="32" width="70" /&gt;
      &lt;field name="person_document" posx="143" posy="32" width="55" /&gt;
      <b>&lt;plugin name="chart_gantt" type="my_plugin_classname" posx="10"  posy="160" width="180" height="80"
        options="dateformat=d.m,descr_width=0.25,arrow_color=#F22,shade_color=#BBB" /&gt;</b>
   &lt;/page&gt;
  &lt;/pages&gt;
&lt;/printdef&gt;
</pre>

Note then "type" value ("my_plugin_classname" in our example) must be your plugin class name, that extends PfPdfPlugin.
CPrintformPDF treats "plugin" item as a special "field" (that's why we place it between ordinary fields definition list) :
<br>it renders it in order of appearance in the list, applies optional "bgcolor" an "rotate" values
(so image created by plugin can have desired background color and beeng rotated to some angle).

<br><br>
And finally, somewhere in your code you prepare data to be visualized, and pass it to the CPrintformPdf object by method
<b>setPluginData($name, $data)</b>, before calling final Render() method.
<br>
<br><b>$name</b> is a name of your plugin "pseudo-field" as it set in the "name" attribute of "plugin" tag.
<br><b>$data</b> is your data to visualize.
Type and structure of this parameter is fully at your choice, as it's you the plugin's author, aren't you ?

<br><br>CPrintformPdf tries to create new instance of your class, passing to it's constructor a TCPDF object ref,current configuration parameters and position of plot area.
Configuration parameters array is constructed from current CPRintformPdf common parameters (including current "stringcharset" value) and options defined
in "<b>options</b>" attribute of plugin tag. "options" value must have a form of comma-delimited string, where each item is "optname=value".
This options string is parsed to associative array ($options = array('optname =&gt;value,...) ) and passed to the plugin constructor function.

<br><br>Below is a simple example of plugin class
<pre>
class PfPdf_Gantt extends PfPdfPlugin {
    private $_config = array();
    private $tcpdf_obj = null;
    private $xpos,$ypos,$width,$height;
    public function __construct($pdfobj, $config=null, $x=0,$y=0,$w=0,$h=0) {
        $this-&gt;tcpdf_obj = $pdfobj;
        $this-&gt;xpos = $x;
        $this-&gt;ypos = $x;
        $this-&gt;width = $w;
        $this-&gt;height = $h;
        $this-&gt;_config = $config;
    }
    public function Render($data) { // just draw a rectangle
        $this-&gt;tcpdf_obj-&gt;Rect($this-&gt;xpos,$this-&gt;ypos,$this-&gt;width,$this-&gt;height,'D');
    }
}
</pre>

<br>To see a working CPrintformPdf plugin, try to search in this site for "pdf_gantt" class.
It draws Gantt charts and can work standalone and as a CPrintformPdf plugin.

<h4>Bonus (experimental) functions</h4>

<a name="AddPageLined"></a>
<b>AddPageLined($title='',$options=null)</b> creates clean "lined" page (that has horisontal and/or vertical lines) with desired parameters like distance between lines and color.
<br><br><b>$title</b> - Optional page title, it is printed on the top.
<br><br><b>$options</b> : if passed, must be an associative array:
<table>
 <tr>
   <th>Element</th><th>Meaning</th>
 </tr>
 <tr>
   <td nowrap="nowrap"><b>$options['step_y']</b></td><td> vertical step (distance between horizontal lines, alwais in millimeters). If omitted, default 5 mm used.</td>
 </tr>
 <tr>
   <td nowrap="nowrap"><b>$options['step_x']</b></td><td> Horizontal step. If omitted, horizontal step will be equal to vertical step. If You want to draw only horizontal lines,
     you have to pass zero value for <b>step_x</b> element. (Similarly, if you want to draw only vertical lines, pass explicitly zero <b>step_y</b> element)</td>
 </tr>
 <tr>
   <td nowrap="nowrap"><b>$options['color']</b></td><td> Setting line color. By default gray used - RGB(180,180,180)</td>
 </tr>
</table>

<br><br>
Drawing Lined page example:
<pre>
$pdf = new PrintFormPdf;
$pdf-&gt;AddPageLined('Lined page title',
    array(
        'step_y'=&gt;12
       ,'step_x'=&gt;12
       ,'color'=&gt;'red'
   )
);
$pdf-&gt;Render();
</pre>

<br><br><a name="AddPageMusicStaff"></a>
<b>AddPageMusicStaff($title='',$options=null)</b> prints clean music staff sheet.
<br>
Called without parameters, it will draw a page without title, containing 10 separated "staves" (with black lines), without bar lines.
<br><br>
<b>$title</b> - page title
<br>$options - associative array:
<table>
  <tr>
    <th>Element</th><th>Meaning</th>
  </tr>
  <tr>
    <td nowrap="nowrap"><b>$options['merged_staves']</b></td><td>"Linked" staves amount. If passed non-zero value, staves will be "merged" by vertical lines, having "merged_staves" in every block.</td>
  </tr>

  <tr>
    <td nowrap="nowrap"><b>$options['measures']</b></td><td>Measure ("bar" in U.S.) amount in each stave. If passed value greater than 1, staves will have bar lines, making NN measures.</td>
  </tr>
  <tr>
    <td nowrap="nowrap"><b>$options['step_roll']</b></td><td>Distanse between first line in every stave, mm. Default is 27 mm.</td>
  </tr>
  <tr>
    <td nowrap="nowrap"><b>$options['step_line']</b></td><td>Distanse between adjacent lines in one stave, mm. Default is 2 mm.</td>
  </tr>
  <tr>
    <td nowrap="nowrap"><b>$options['accolade']</b></td><td>If set to 1 (or any non-zero value), united staves will have accolades.</td>
  </tr>
  <tr>
    <td nowrap="nowrap"><b>$options['color']</b></td><td>Color to draw lines. Default is black.</td>
  </tr>

</table>

<br><br><a name="AddPageSudoku" id="AddPageSudoku"></a>
<b>AddPageSudoku($title='', $level=false, $options=null)</b> depending on parameters, draws empty or "filled" Sudoku puzzle page.
To generate random puzzle, the class <a href="http://www.phpclasses.org/package/2674-PHP-Generate-and-solve-sudoku-puzzles.html">class.Sudoku.php</a> is used.
автора <a href="http://www.phpclasses.org/professionals/profile/280/">Richard Munroe</a>.
<br><b>$title</b> - Optional page title.
<br><b>$level</b> - Difficulty level for generated puzzles, must be an integer value in ranhe 1...10.
If parameter omitted, no puzzle is generated, and empty sudoku grids will be drawn.
Used puzzle generation algorithm sometimes may return empty puzzle, so some puzzle blocks may stay empty, so don't be surprized if that happens.

<br><br>Optional third parameter, associative array $options can be used for colors tuning:

<br><br>
<table>
  <tr>
    <th>Element</th><th>Meaning</th><th>Default value</th>
  </tr>
  <tr>
    <td nowrap="nowrap"><b>$options['color_grid']</b></td><td>Grid color</td><td>Black - RGB(0,0,0)</td>
  </tr>
  <tr>
    <td nowrap="nowrap"><b>$options['color_cell']</b></td><td>Printed Digits color</td><td>Black - RGB(0,0,0)</td>
  </tr>
</table>

<h4>Possible problems</h4>

1. Impossible to load template PDF. TCPDF shows warning.
<br>
Probably, you're trying to use "packed" PDF file, having unsupported packing (shrinking) algorithm, that is unsupported by classes FPDF / FPDFI.
For example, ZIP packed PDF can't be loaded. It's because modules written on PHP cannot "understand" some PDF format features..
<br>
Solution: re-save Your template PDF without shrinking.

<h4>Change log</h4>

<h5>1.4.0023 (2014-04-16)</h5>
<ul>
  <li>Added <a href="#apfields">"All Pages Fields"</a> support </li>
  <li>Added <a href="#setResourcePaths">setResourcePaths()</a> function</li>
</ul>

<h5>1.3.0020 (2014-02-01)</h5>
<ul>
  <li>Added <a href="#disableImages">disableImages()</a> function</li>
  <li>Added <a href="#f_repeat">repeat</a> feature</li>
</ul>

<h5>1.2 (2013-12-10)</h5>
<ul>
  <li>Added <a href="#addPageDef">addPageDef()</a> function, to load page definition programmatically</li>
</ul>

<h5>1.1.0017 (2013-05-22)</h5>
<ul>
  <li>bugfix: class raises error on convertHTMLColorToDec() calling, because of TCPDF 6.x has moved convertHTMLColorToDec() to static methods in TCPDF_COLORS class</li>
</ul>

<h5>1.1 (2013-04-26)</h5>
<ul>
  <li>new: plugin support (abstract class PfPdfPlugin)</li>
</ul>

<h5>1.00 (2012-14-11)</h5>
<ul>
  <li>First release published
  </li>
</ul>

<!-- DOC END -->
<br />

<br /><br />

<div style="text-align:right">Distributed under: BSD License</div>
<br>
<hr>
<div align=center><font size=-2>Copyright &copy; 2012-2013 Alexander Selifonov, <a href="http://www.selifan.ru">www.selifan.ru</a>
</font></div>
</body></html>
